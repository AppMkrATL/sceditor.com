(function(a){"use strict",a.sceditor.XHTMLSerializer=function(){var b=this,c={indentStr:"	"},d=[],e=0,f,g,h,i,j,k,l,m,n,o,p;f=function(a){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return a?a.replace(/[&<>"]/g,function(a){return b[a]||a}):""},g=function(a){return a.replace(/[\r\n]/,"").replace(/[^\S|\u00A0]+/g," ")},b.serialize=function(a,b){d=[];if(b){a=a.firstChild;while(a)h(a),a=a.nextSibling}else h(a);return d.join("")},h=function(a){switch(a.nodeType){case 1:var b=a.nodeName.toLowerCase();b==="!"&&l(a),j(a);break;case 3:m(a);break;case 4:k(a);break;case 8:l(a);break;case 9:case 11:i(a);break;case 2:case 5:case 6:case 7:case 10:case 12:}},i=function(a){var b;b=a.firstChild;while(b)h(b),b=b.nextSibling},j=function(a){var b,c,g=a.nodeName.toLowerCase(),i=a.attributes.length,j=!a.firstChild&&/^(?:area|base|br|col|embed|hr|img|input|link|meta|param)$/.test(g);o(a)&&n(),d.push("<"+g);while(i--)c=a.attributes[i],d.push(" ",c.name.toLowerCase(),'="',f(c.value),'"');d.push(j?" />":">"),e++,b=a.firstChild;while(b)h(b),b=b.nextSibling;e--,j||(o(a)&&a.firstChild&&n(),d.push("</",g,">"))},k=function(a){n(),d.push("<![CDATA[",f(a.nodeValue),"]]>")},l=function(a){n(),d.push("<!-- ",f(a.nodeValue)," -->")},m=function(a){var b=g(a.nodeValue);b&&(o(a)&&n(),d.push(f(b)))},n=function(){var a=e;p();while(a--)d.push(c.indentStr)},o=function(b){if(b.nodeType!==1){if(b.previousSibling&&a.sceditor.dom.isInline(b.previousSibling))return!1;b=b.parentNode}return!b.previousSibling&&!a.sceditor.dom.isInline(b.parentNode)?!0:!a.sceditor.dom.isInline(b)},p=function(){d.length&&d.push("\n")}},a.sceditor.plugins.xhtml=function(){var b=this,c={},d={},e,f,g,h,i,j;b.init=function(){a.isEmptyObject(a.sceditor.plugins.xhtml.converters||{})||a.each(a.sceditor.plugins.xhtml.converters,function(b,d){a.each(d.tags,function(a){c[a]||(c[a]=[]),c[a].push(d)})}),e(this)},e=function(b){var c={bold:{txtExec:["<strong>","</strong>"]},italic:{txtExec:["<em>","</em>"]},underline:{txtExec:['<span style="text-decoration: underline;">',"<span>"]},strike:{txtExec:['<span style="text-decoration: line-through;">',"<span>"]},subscript:{txtExec:["<sub>","</sub>"]},superscript:{txtExec:["<sup>","</sup>"]},left:{txtExec:['<div style="text-align: left;">',"<div>"]},center:{txtExec:['<div style="text-align: center;">',"<div>"]},right:{txtExec:['<div style="text-align: right;">',"<div>"]},justify:{txtExec:['<div style="text-align: justify;">',"<div>"]},font:{txtExec:function(b){var c=this;a.sceditor.command.get("font")._dropDown(c,b,function(a){c.insertText('<span style="font-family: '+a+';">',"</span>")})}},size:{txtExec:function(b){var c=this;a.sceditor.command.get("size")._dropDown(c,b,function(a){c.insertText('<span style="font-size: '+a+';">',"</span>")})}},color:{txtExec:function(b){var c=this;a.sceditor.command.get("color")._dropDown(c,b,function(a){c.insertText('<span style="color: '+a+';">',"</span>")})}},bulletlist:{txtExec:["<ul><li>","</li></ul>"]},orderedlist:{txtExec:["<ol><li>","</li></ol>"]},table:{txtExec:["<table><tr><td>","</td></tr></table>"]},horizontalrule:{txtExec:["<hr />"]},code:{txtExec:["<code>","</code>"]},image:{txtExec:function(a,b){var c=prompt(this._("Enter the image URL:"),b);c&&this.insertText('<img src="'+c+'" />')}},email:{txtExec:function(a,b){var c=b&&b.indexOf("@")>-1?null:b,d=prompt(this._("Enter the e-mail address:"),c?"":b),e=prompt(this._("Enter the displayed text:"),c||d)||d;d&&this.insertText('<a href="mailto:'+d+'">'+e+"</a>")}},link:{txtExec:function(a,b){var c=b&&b.indexOf("http://")>-1?null:b,d=prompt(this._("Enter URL:"),c?"http://":b),e=prompt(this._("Enter the displayed text:"),c||d)||d;d&&this.insertText('<a href="'+d+'">'+e+"</a>")}},quote:{txtExec:["<blockquote>","</blockquote>"]},youtube:{txtExec:function(b){var c=this;a.sceditor.command.get("youtube")._dropDown(c,b,function(a){c.insertText('<iframe width="560" height="315" src="http://www.youtube.com/embed/{id}?wmode=opaque" data-youtube-id="'+a+'" frameborder="0" allowfullscreen></iframe>')})}},rtl:{txtExec:['<div stlye="direction: rtl;">',"</div>"]},ltr:{txtExec:['<div stlye="direction: ltr;">',"</div>"]}};b.commands=a.extend(!0,{},c,b.commands)},b.signalToSource=function(b,c){return c=c.jquery?c[0]:c,a(c).find(".sceditor-selection").remove(),f(c),h(c),j(c),(new a.sceditor.XHTMLSerializer).serialize(c,!0)},b.signalToWysiwyg=function(a){return a},b.convertTagTo=function(a,b){var c,d,e=a.attributes.length,f=a.ownerDocument.createElement(b);while(e--)d=a.attributes[e],f.setAttribute(d.name,d.value);while(c=a.firstChild)f.appendChild(c);return a.parentNode.replaceChild(f,a),f},g=function(d,e){c[d]&&a.each(c[d],function(c,f){f.tags[d]?a.each(f.tags[d],function(c,d){if(typeof e.attr(c)=="undefined")return;if(d&&a.inArray(e.attr(c),d)<0)return;f.conv.call(b,e[0])}):f.conv&&f.conv.call(b,e[0])})},f=function(b){if(!c)return;a.sceditor.dom.traverse(b,function(b){var d=a(b),e=b.nodeName.toLowerCase();if(!c)return;g("*",d),g(e,d)},!0)},h=function(b){a.sceditor.dom.traverse(b,function(b){var c=b.nodeName.toLowerCase(),d=a.sceditor.plugins.xhtml.allowedTags,e=a.sceditor.plugins.xhtml.disallowedTags;if(b.nodeType===4)c="!cdata";else if(c==="!"||b.nodeType===8)c="!comment";d&&d.length&&b.nodeType!==3?a.inArray(c,d)<0&&b.parentNode&&b.parentNode.removeChild(b):e&&e.length&&b.nodeType!==3&&a.inArray(c,e)>-1&&b.parentNode&&b.parentNode.removeChild(b)})},i=function(b,c){var d={};return b&&a.extend(d,b),c?(a.each(c,function(b,c){a.isArray(d[b])?a.isArray(c)&&(d[b]=a.merge(d[b],c)):d[b]=c}),d):d},j=function(b){d={},a.sceditor.dom.traverse(b,function(b){if(!b.attributes)return;var c,e,f=b.nodeName.toLowerCase(),g=a.sceditor.plugins.xhtml.allowedAttribs,h=a.sceditor.plugins.xhtml.disallowedAttribs,j=b.attributes.length;if(g&&!a.isEmptyObject(g)&&j){d[f]||(d[f]=i(g["*"],g[f]));while(j--)c=b.attributes[j],e=typeof d[f][c.name]=="undefined",a.isArray(d[f][c.name])&&a.inArray(c.value,d[f][c.name])<0&&(e=!0),e&&b.removeAttribute(c.name)}else if(h&&!a.isEmptyObject(h)&&j){d[f]||(d[f]=i(h["*"],h[f]));while(j--)c=b.attributes[j],e=typeof d[f][c.name]!="undefined",a.isArray(d[f][c.name])&&a.inArray(c.value,d[f][c.name])>-1&&(e=!0),e&&b.removeAttribute(c.name)}})}},a.sceditor.plugins.xhtml.converters=[{tags:{"*":{width:null}},conv:function(b){var c=a(b);c.css("width",c.attr("width")).removeAttr("width")}},{tags:{"*":{height:null}},conv:function(b){var c=a(b);c.css("height",c.attr("height")).removeAttr("height")}},{tags:{li:{value:null}},conv:function(b){a(b).removeAttr("value")}},{tags:{"*":{text:null}},conv:function(b){var c=a(b);c.css("color",c.attr("text")).removeAttr("text")}},{tags:{"*":{size:null}},conv:function(b){var c=a(b);c.css("font-size",c.css("font-size")).removeAttr("size")}},{tags:{"*":{color:null}},conv:function(b){var c=a(b);c.css("color",c.attr("color")).removeAttr("color")}},{tags:{"*":{face:null}},conv:function(b){var c=a(b);c.css("font-family",c.attr("face")).removeAttr("face")}},{tags:{"*":{language:null}},conv:function(b){var c=a(b),d=c.attr("language");/jscript|javascript|js/i.test(d)?c.attr("type","text/javascript"):/vb/i.test(d)&&c.attr("type","text/vbscript"),c.removeAttr("language")}},{tags:{"*":{align:null}},conv:function(b){var c=a(b);c.css("text-align",c.attr("align")).removeAttr("align")}},{tags:{"*":{border:null}},conv:function(b){var c=a(b);c.css("border-size",c.attr("border")).removeAttr("border")}},{tags:{applet:{name:null},img:{name:null},layer:{name:null},map:{name:null},object:{name:null},param:{name:null}},conv:function(b){a(b).removeAttr("name")}},{tags:{hr:{noshade:null}},conv:function(b){var c=a(b);c.css("border-style","solid").removeAttr("noshade")}},{tags:{"*":{nowrap:null}},conv:function(b){var c=a(b);c.css("white-space","nowrap").removeAttr("nowrap")}},{tags:{big:null},conv:function(b){a(this.convertTagTo(b,"span")).css("font-size","larger")}},{tags:{small:null},conv:function(b){a(this.convertTagTo(b,"span")).css("font-size","smaller")}},{tags:{b:null},conv:function(b){a(this.convertTagTo(b,"strong"))}},{tags:{u:null},conv:function(b){a(this.convertTagTo(b,"span")).css("text-decoration","underline")}},{tags:{i:null},conv:function(b){a(this.convertTagTo(b,"em"))}},{tags:{s:null,strike:null},conv:function(b){a(this.convertTagTo(b,"span")).css("text-decoration","line-through")}},{tags:{dir:null},conv:function(a){this.convertTagTo(a,"ul")}},{tags:{center:null},conv:function(b){a(this.convertTagTo(b,"div")).css("text-align","center")}},{tags:{font:null},conv:function(a){this.convertTagTo(a,"span")}}],a.sceditor.plugins.xhtml.allowedAttribs={},a.sceditor.plugins.xhtml.disallowedAttribs={},a.sceditor.plugins.xhtml.allowedTags=[],a.sceditor.plugins.xhtml.disallowedTags=[]})(jQuery);